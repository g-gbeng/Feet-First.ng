<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Feet-First.ng â€” Profile</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  /* ===============================
     FEET-FIRST THEME VARIABLES
  =============================== */
  :root {
    --primary: #111111;
    --accent: #d4af37;
    --bg: #f4f4f4;
    --card-bg: #ffffff;
    --text-main: #222222;
    --text-muted: #6b6b7a;
  }

  body {
    font-family: "Poppins", sans-serif;
    background: var(--bg);
    margin: 0;
    color: var(--text-main);
    animation: fadeIn .5s ease-in;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .top-bar {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 1100px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
  }

  .top-bar strong {
    color: var(--primary);
  }

  .avatar {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    background: var(--primary);
    color: var(--accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    cursor: pointer;
  }

  .container-main {
    max-width: 1100px;
    margin: 110px auto 40px;
    padding: 16px;
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 16px;
  }

  .card-glass {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 10px 30px rgba(0,0,0,.05);
  }

  .profile-pic-lg {
    width: 120px;
    height: 120px;
    border-radius: 14px;
    background: var(--primary);
    color: var(--accent);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 48px;
    font-weight: 700;
  }

  label {
    font-size: .85rem;
    margin-top: 10px;
  }

  .btn-primary {
    background: var(--primary);
    border: none;
  }

  .btn-primary:hover {
    background: var(--accent);
    color: #000;
  }

  @media (max-width: 900px) {
    .container-main {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>

<body>

<div class="top-bar">
  <strong>My Profile</strong>
  <div id="topAvatar" class="avatar">U</div>
</div>

<main class="container-main">

  <!-- LEFT -->
  <aside class="card-glass text-center">
    <div id="profileAvatar" class="profile-pic-lg mx-auto">U</div>
    <h5 id="displayName" class="mt-3">User</h5>
    <p id="displayEmail" class="text-muted small">email@example.com</p>

    <button id="logoutBtn" class="btn btn-outline-danger btn-sm mt-3 w-100">
      Logout
    </button>
  </aside>

  <!-- RIGHT -->
  <section class="card-glass">
    <h5>Personal Information</h5>

    <label>Full Name</label>
    <input id="fullName" class="form-control" disabled />

    <label>Email</label>
    <input id="email" class="form-control" disabled />

    <button id="saveBtn" class="btn btn-primary mt-3">
      
    </button>

    <div id="msg" class="small mt-2"></div>
  </section>

</main>

<script>
/* ===============================
   AUTH CHECK
================================ */
const token = localStorage.getItem("token");

if (!token) {
  window.location.href = "/login.html";
}

/* ===============================
   HELPERS
================================ */
function initials(name) {
  if (!name) return "U";
  return name.split(" ").map(n => n[0]).join("").toUpperCase();
}

/* ===============================
   LOAD USER
================================ */
async function loadProfile() {
  try {
    const res = await fetch("/api/users/me", {
      headers: {
        Authorization: `Bearer ${token}`
      }
    });

    if (!res.ok) {
      localStorage.clear();
      window.location.href = "/login.html";
      return;
    }

    const user = await res.json();

    document.getElementById("displayName").textContent = user.name;
    document.getElementById("displayEmail").textContent = user.email;
    document.getElementById("fullName").value = user.name;
    document.getElementById("email").value = user.email;

    document.getElementById("profileAvatar").textContent = initials(user.name);
    document.getElementById("topAvatar").textContent = initials(user.name);

  } catch {
    window.location.href = "/login.html";
  }
}

loadProfile();

/* ===============================
   SAVE PROFILE
================================ */
document.getElementById("saveBtn").onclick = async () => {
  const name = document.getElementById("fullName").value.trim();
  const msg = document.getElementById("msg");

  if (!name) {
    msg.textContent = "Name is required";
    msg.style.color = "red";
    return;
  }

  try {
    const res = await fetch(
      "/api/users/profile/" + JSON.parse(atob(token.split('.')[1])).id,
      {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ name })
      }
    );

    if (!res.ok) {
      msg.textContent = "";
      msg.style.color = "red";
      return;
    }

    msg.textContent = "Profile updated successfully";
    msg.style.color = "green";
    loadProfile();

  } catch {
    msg.textContent = "Network error";
    msg.style.color = "red";
  }
};

/* ===============================
   LOGOUT
================================ */
document.getElementById("logoutBtn").onclick = () => {
  localStorage.clear();
  window.location.href = "/login.html";
};
</script>

</body>
</html>
