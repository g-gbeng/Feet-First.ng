<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Saved Items</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --gold: #d4af37;
}

body {
  background: #fff;
  font-family: "Segoe UI", sans-serif;
}

/* ===== TOP BAR ===== */
.top-bar {
  position: sticky;
  top: 0;
  background: white;
  border-bottom: 1px solid #eee;
  z-index: 1000;
}

.icon-btn {
  position: relative;
  cursor: pointer;
  font-size: 20px;
}

.badge-count {
  position: absolute;
  top: -6px;
  right: -8px;
  background: var(--gold);
  color: white;
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 50%;
}

/* ===== FAVORITE ITEM ===== */
.saved-item {
  border-bottom: 1px solid #eee;
  padding: 15px 0;
}

.price {
  color: var(--gold);
  font-weight: 600;
}

/* ===== BUTTONS ===== */
.btn-gold {
  background: var(--gold);
  color: white;
  border: none;
}

.btn-gold:hover {
  background: #b8962e;
}

.btn-outline-gold {
  border: 1px solid var(--gold);
  color: var(--gold);
}

/* FORCE SIDE-BY-SIDE ON ALL MOBILE */
.action-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: nowrap;
}

.action-buttons button {
  flex: 1;
  white-space: nowrap;
}

/* MOBILE IMAGE SCALE */
@media (max-width: 576px) {
  .saved-item {
    flex-direction: column;
    align-items: flex-start !important;
  }

  .saved-item img {
    width: 100%;
    max-width: 480px;
    margin-bottom: 10px;
  }
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar py-3">
  <div class="container d-flex justify-content-end gap-4">
    <div class="icon-btn" onclick="goToFavorites()">
      ‚ù§Ô∏è <span class="badge-count" id="favCount">0</span>
    </div>
    <div class="icon-btn" onclick="goToCart()">
      üõí <span class="badge-count" id="cartCount">0</span>
    </div>
  </div>
</div>

<!-- CONTENT -->
<div class="container my-5">
  <h3 class="mb-4 text-center">Saved Items</h3>
  <div id="favoritesList"></div>
</div>

<script>
function getUserId() {
  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "/login.html";
    return null;
  }
  return JSON.parse(atob(token.split(".")[1])).id;
}

const userId = getUserId();
const CART_KEY = `cart_${userId}`;
const FAV_KEY = `fav_${userId}`;

let cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];
let favorites = JSON.parse(localStorage.getItem(FAV_KEY)) || [];

function updateBadges() {
  document.getElementById("cartCount").innerText =
    cart.reduce((sum, i) => sum + i.qty, 0);
  document.getElementById("favCount").innerText = favorites.length;
}

function renderFavorites() {
  const container = document.getElementById("favoritesList");
  container.innerHTML = "";

  if (favorites.length === 0) {
    container.innerHTML =
      "<p class='text-center text-muted'>You have no saved items.</p>";
    return;
  }

  favorites.forEach((item, index) => {
    container.innerHTML += `
      <div class="saved-item d-flex align-items-center gap-3">
        <img src="/images/${item.image}" width="80">

        <div class="flex-grow-1">
          <strong>${item.name}</strong><br>
          <span class="price">‚Ç¶${item.price.toLocaleString()}</span>
        </div>

        <div class="action-buttons">
          <button class="btn btn-sm btn-gold" onclick="moveToCart(${index})">
            Add to Cart
          </button>
          <button class="btn btn-sm btn-outline-danger" onclick="removeFavorite(${index})">
            Remove
          </button>
        </div>
      </div>
    `;
  });
}

function moveToCart(index) {
  const item = favorites[index];
  const existing = cart.find(i => i._id === item._id);

  if (existing) existing.qty += 1;
  else cart.push({ ...item, qty: 1 });

  favorites.splice(index, 1);

  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  localStorage.setItem(FAV_KEY, JSON.stringify(favorites));

  updateBadges();
  renderFavorites();
}

function removeFavorite(index) {
  favorites.splice(index, 1);
  localStorage.setItem(FAV_KEY, JSON.stringify(favorites));
  updateBadges();
  renderFavorites();
}

function goToCart() {
  window.location.href = "/cart.html";
}
function goToFavorites() {
  window.location.href = "/favorites.html";
}

updateBadges();
renderFavorites();
</script>

</body>
</html>
