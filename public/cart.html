<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Your Cart</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --gold: #d4af37;
}

body {
  background: #fff;
  font-family: "Segoe UI", sans-serif;
}

.cart-item {
  border-bottom: 1px solid #eee;
  padding: 15px 0;
}

.price {
  color: var(--gold);
  font-weight: 600;
}

.btn-gold {
  background: var(--gold);
  color: white;
  border: none;
}

.btn-gold:hover {
  background: #b8962e;
}

.btn-gold:disabled {
  background: #ddd;
  cursor: not-allowed;
}
</style>
</head>

<body>

<div class="container my-5">
  <h3 class="mb-4 text-center">Your Cart</h3>

  <div id="cartItems"></div>

  <div class="d-flex justify-content-between align-items-center mt-4">
    <strong>Total: ₦<span id="cartTotal">0</span></strong>
    <a href="checkout.html" class="btn btn-gold" id="checkoutBtn">
      Proceed to Checkout
    </a>
  </div>
</div>

<script>
function getUserId() {
  const token = localStorage.getItem("token");
  if (!token) {
    window.location.href = "/login.html";
    return null;
  }
  return JSON.parse(atob(token.split(".")[1])).id;
}

const userId = getUserId();
const CART_KEY = `cart_${userId}`;
let cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];

const cartItems = document.getElementById("cartItems");
const cartTotal = document.getElementById("cartTotal");
const checkoutBtn = document.getElementById("checkoutBtn");

function renderCart() {
  cartItems.innerHTML = "";
  let total = 0;

  if (cart.length === 0) {
    cartItems.innerHTML =
      "<p class='text-center text-muted'>Your cart is empty</p>";
    cartTotal.innerText = "0";
    checkoutBtn.classList.add("disabled");
    checkoutBtn.setAttribute("aria-disabled", "true");
    checkoutBtn.onclick = e => e.preventDefault();
    return;
  }

  checkoutBtn.classList.remove("disabled");
  checkoutBtn.onclick = null;

  cart.forEach((item, index) => {
    total += item.price * item.qty;

    cartItems.innerHTML += `
      <div class="cart-item d-flex align-items-center gap-3">
        <img src="/images/${item.image}" width="80">

        <div class="flex-grow-1">
          <strong>${item.name}</strong><br>
          <span class="price">₦${item.price.toLocaleString()}</span>
        </div>

        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-sm btn-outline-secondary" onclick="changeQty(${index}, -1)">−</button>
          <span>${item.qty}</span>
          <button class="btn btn-sm btn-outline-secondary" onclick="changeQty(${index}, 1)">+</button>
        </div>

        <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">✕</button>
      </div>
    `;
  });

  cartTotal.innerText = total.toLocaleString();
}

function changeQty(index, delta) {
  cart[index].qty += delta;
  if (cart[index].qty <= 0) cart.splice(index, 1);
  saveCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  saveCart();
}

function saveCart() {
  localStorage.setItem(CART_KEY, JSON.stringify(cart));
  renderCart();
}

renderCart();
</script>

</body>
</html>
